# TTK4145 Real Time Programming - Elevator Project

This project aims to create software for controlling `n` elevators working in parallel across `m` floors. The complete Project description is found [here](https://github.com/TTK4145/Project).

### Network structure and information distribution
The nodes are connected in a cluster and cooperate by the peer-to-peer principle. This means that each node serves as a backup for every other node, and keeps information about all orders currently being served. As long as only one node fails at a time, a restarted node can therefore backup from any node once it gets back online. The node that first receives an order through a button press requests a priority for the order from the other nodes, and distributes the order to the node with the highest priority. Every node online guards the order and tries to redistribute it if it is not served within a given time limit.

### Software overview
The elevators consists of the following modules each:
  
  ``
  Network
  ``
  * This module creates a node for the local elevator, further, the module broadcasts its own IP and listens for IP broadcasts, as well as creating a cluster of nodes. The ``Network`` module is responsible for triggering a global update in the ``Guard`` modules whenever reconnecting to a cluster, as well as setting lights using the ``Elevio`` module.

  ``
  Elevio
  ``
  * This module polls buttons and read floor sensors. The ``Elevio`` is responsible for alerting the ``Distributer`` module when a new button is pressed, and alerting the ``Elevator`` module when a new floor is reached.

  ``
  Distributer
  ``
  * The ``Distributer`` module is tasked with distribution of orders across to the best suited node. To do so it utilizes a submodule, ``Priority``, to collect priorities from all connected nodes and distributes the order to the node with highest priority by alerting the corresponding ``Elevator`` module. The ``Distribute`` module is also responsible of adding new orders globally to the ``Guard`` modules and setting lights globally via the ``Elevio`` modules.

  ``
  Elevator
  ``
  * The ``Elevator`` module is a finite state machine and is responsible for handeling orders from the ``Distributer`` module, as well as alerting the respective module when a order is handled. Furthermore it triggers an global update in the ``Guard`` modules whenever a change in state occurs. The ``Elevator`` module uses the ``Elevio`` module to move the elevator to desired floors.

  ``
  Guard
  ``
  * This module is responsible for keeping track of all orders currently in the cluster of nodes, as well as keeping a copy of the states of all elevators. The ``Guard`` module alerts the ``Distributer`` module when a order exceeds the set time limit, so it can be redistributed. Prior to this, the order of the corresponding node is removed via the respective ``Elevator`` module.

### Using the software
In order to use the software you need to perform the following procedure at one or multiple computers, depending on how many elevators you want to run, at the Sanntidslab. 

1. Install Elixir and ElevatorServer:

    ```bash
    $ sudo apt-get install elixir
    $ sudo usermod -a -G iocard student
    $ sudo cargo install --force ttk4145_elevator_server
    ```

2. First, move into your project directory:

    ```bash
    $ cd PATH_TO_YOUR_PROJECT
    ```

3. Next invoke the executable from your project:

    ```bash
    $ ./run.sh
    ```
Alternatively, set up the simulator by following the simulator [instructions](https://github.com/TTK4145/Simulator-v2/tree/86a0a3ff53a77aa7517ebcbd0940a75d7a1ebc11).





### Disclaimer
The following code was handed out in advance and entirely or partly copied:
- The elevator [driver](./lib/Elevio/driver_elixir.ex) with minor modifications. The code was generated by [jostlowe](https://github.com/jostlowe), with source and documentation found [here](https://github.com/TTK4145/driver-elixir).
- The elevator [priority](./lib/Distributer/priority.ex) algorithm to assign priority to a given order. The code was generated by [jostlowe](https://github.com/jostlowe), with source and documentation found [here](https://github.com/jostlowe/kokeplata/blob/master/lib/elevatorstuff.ex).
- The elevator button [poller](./lib/Elevio/poller.ex) is heavily inspired by [jostlowe](https://github.com/jostlowe)'s work [here](https://github.com/jostlowe/elevator_elixir_v2/tree/master/lib).
